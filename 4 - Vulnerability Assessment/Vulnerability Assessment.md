
1. [Windows Vulnerabilities](Vulnerability%20Assessment.md#windows-vulnerabilities)
2. [Microsoft IIS and WebDav](Vulnerability%20Assessment.md#iis-and-webdav)
3. [EternalBlue](Vulnerability%20Assessment.md#eternalblue)
4. [BlueKeep](Vulnerability%20Assessment.md#bluekeep)
5. [Pass The Hash Attacks](Vulnerability%20Assessment.md#pass-the-hash)
6. [ShellShock](Vulnerability%20Assessment.md#shellshock)
7. [Nessus](Vulnerability%20Assessment.md#nessus)
7. [WMAP](Vulnerability%20Assessment.md#wmap)


---
### Windows-Vulnerabilities

*Section is covered in the System_Host Based Attacks*
### Common Windows Vulnerability Types

*Section is covered in the System_Host Based Attacks*
### Commonly Exploited Windows Services

*Section is covered in the System_Host Based Attacks*

---
## Vulnerability-Scanning 

Vulnerability scanning & detection is the process of scanning a target for vulnerabilities and verifying whether they can be exploited. This information will useful during the exploitation phase
### Vulnerability Scanning with MSF

Can use auxiliary and exploit modules to scan and identify inherent vulnerabilities in services, OS's and webapps.

- Start PostgreSQL/MSFConsole: `service postgresql start` > `msfconsole`
- (Optional) Can create a workspace: `workspace -a workspace_name`
- (Optional) Can set the RHOST/RHOSTS global variables set you dont have to set the IP for each module execution `setg RHOST target`
### 1. Getting Service Versions and Operating Systems

Goal: Key piece of information for vulnerability scanning for a target OS or services running on it is the service version. Can get service info and the OS from nmap or metasploit modules: 

**a.  Scan using NMap**

```
db_nmap -sS -sV -O -p- target
```

- `-sS` SYN Scan/Stealth Scan 
- `-sV` Service Version detection
- `-O`   Operating system detection
- `-p-`  The full TCP port range (65,535)

**b. Scan using Metasploit**

Metasploit doesn't have a single module that does everything in one shot like `nmap`, need to combine different auxiliary modules to accomplish this:
1. Can use `auxiliary/scanner/portscan/tcp` for a general TCP scan or `auxiliary/scanner/portscan/syn` to perform the SYN scan.
```
use auxiliary/scanner/portscan/tcp
set RHOSTS <target>
set PORTS 1-65535
run
```
2. **Getting Service Version**: Use various service version modules (like `http_version`, `smb_version`) to detect services and versions.
```
use auxiliary/scanner/smb/smb_version
set RHOSTS <target>
run
```
3. **Getting OS**: There isn't a direct way to perform OS detection with metasploit. Some auxiliary scanners like smb_version can have OS detection but you might need use exploits to fingerprint the system. 
### 2. Look for Exploits/Vulnerabilities

There's a number of way to search for exploit and vulnerabilities:
#### 2.a - Manual Search in Metasploit
The found services and their versions from the scans should be in `services` in Metasploit. Take each of the observed services and look through Metasploit using its built-in utility for any exploits for each of them

```
search type:exploit name:<service_name>
```

If you don't find the service  in Metasploit, it could be that:
1. The particular version of the service isn't vulnerable to any inherent exploit or
2. There isn't a Metasploit exploit available to exploit the service 

If you <u>do</u> find a service that might work with an exploit, you can  double-check through the module's description to confirm that the version of the service would.
```
use <module>
info
```

**Random note**: Confirm the operating system (Linux/Windows) for the payload so that you can get a meterpreter session

```
set payload windows/meterpreter/reverse_tcp
```

#### 2.b - Kali Searchsploit

Another search option for looking for exploits is built-in to Kali which is `searchsploit`.  Searchsploit is a cmd-line utility which searches the ExploitDB for exploits. The searches can bring in exploit/exploit code that isn't available in Metasploit console and also Metasploit exploits, so we can limit the search to just metasploit exploit modules. Metasploit modules will have (Metasploit) in the exploits name so we can grep the search to filter the other results out:
```
searchsploit " <service> " | grep -e "Metasploit"
```
You can see some of the service versions from the `searchsploit " <service> "` search of some of the exploits and the exploits with the a metasploit equivalent module should have OS versions to see if it works for the target.

#### 2.c - Metasploit Autopwn

Autopwn is a plugin that does a scan of the open services and provides exploit modules that could work with each of the services. This only works best after enumerating services

- Link to Github: https://github.com/hahwul/metasploit-autopwn

- download db_autopwn.rb file in metasploit plugin directory

```
#> wget https://raw.githubusercontent.com/hahwul/metasploit-autopwn/master/db_autopwn.rb
```

If saved to downloads...
```
sudo mv db_autopwn.rb /usr/share/metasploit-framework/plugins/
```
- Load the plugin
```
load db_autopwn
```

- Run the plugin: This can be overwhelming, so narrowing the search to just ports would provide a list of exploits for a port
```
db_autopwn -p -t -PI <port>
```
- `-p` Select modules based on open ports
- `-t` Shows all matching exploit modules
- `-PI` Only exploit hosts with these ports open

#### 2.d. - Analyze Command

The Metasploit `analyze`  command will analyze the contents of the metasploit database (hosts,services) and provide a list of vulnerabilities that the services are affected by.

```
analyze
```

Can see the found vulnerabilities using `vulns`.

---
### IIS-and-WebDav

*Section is covered in the System_Host Based Attacks*

---
## Vulnerability-Analysis

### EternalBlue

*Section is covered in the System_Host Based Attacks*

## BlueKeep

*Section is covered in the System_Host Based Attacks*

---

## Pass-The-Hash

*Section is covered in the System_Host Based Attacks*

---

### Frequently Exploit Linux Services

*Section is covered in the System_Host Based Attacks*

### ShellShock

*Section is covered in the System_Host Based Attacks*

---

### Nessus

Nessus is a proprietary vulnerability scanner developed by Tenable, designed to automate the identification of vulnerabilities in target systems. Once Nessus completes a scan, the results can be imported into Metasploit (MSF) for further analysis and exploitation.

The scanner identifies vulnerabilities by first performing host discovery, using ping to find active hosts on a network. Once a host is identified, Nessus performs a port scan to gather service information, including the version of each service running on the open ports. It then cross-references this information against its extensive vulnerability database, which includes CVE codes and links to relevant Metasploit modules when available. This automated process eliminates the need for manual vulnerability scanning and provides detailed insight into the weaknesses present on a system.

Nessus relies on plugins, which are small text-based scripts, to perform these scans and detect vulnerabilities. Some plugins target specific vulnerabilities, while others are designed for broader scans. These plugins enhance the flexibility and precision of Nessus, allowing it to adapt to various scanning needs.

**There’s two ways to setup Nessus:**

1. Web application = Must easier to setup/run. Just need a browser to connect to the Nessus web app and configure/start scans
2. Network service = Need to have a network client in order to connect to the Nessus server and issue a vulnerability scan. This is much more complicated to configure
### Installing Nessus Essentials

1. <u>Download Nessus</u>: Go to the Nessus Essentials Download Page[https://www.tenable.com/products/nessus/nessus-essentials](https://www.tenable.com/products/nessus/nessus-essentials). Need to register for an activation code with an email address since this is where they’ll send activation code will be sent to. On the download page, look for the Debian version (ie `Nessus…-debian6_amd64.deb`).
2. <u>Install Nessus</u>: Use `dpkg`  with the `-i` option to install the debian package. Might need to update the permission so that its executable (`chmod +x <nessus_binary>`)

```
sudo dpkg -i <Nessus install location>
```
- `dpkg` = Download package
-  `-i` = install

2. <u>Start Nessus</u>: - Started the `nessusd` services which worked for me but you might need to start a `nessusd.server` service for the Nessus scanner as well.

```
sudo systemctl start nessusd
```

3. <u>Check the status of nessus</u>: Can use `systemctl` which checks the Nessus service's status through `systemd` to lets you know if its running/stopped etc or use `ps` which checks all the running services and search for the nessus service to see if its running. 

**Using systemctl**
```
sudo systemctl status nessusd.service
```

**Using ps**
```
ps aux | grep nessusd
```
- **`a`**: Shows processes from all users.
- **`u`**: Displays detailed info, like user, CPU, and memory usage.
- **`x`**: Includes processes not tied to a terminal (like background services/daemons).
    
4. <u>Connect to the Nessus App and go through the initial Nessus setup process</u>: Navigate to  `https//localhost:8834/#/`, then follow the prompts
	- **Step 1 - Choose how to deploy Nessus**:  Select Nessus Essentials (Or whatever you registered for)
	- *(OPTIONAL Step) Get an activation code: You should've already gotten an activate code so you can skip this* 
	- **Step 2 -Register Nessus**: Put in the registration code, to activate it.
		- IMPORTANT: MAKE SURE THE ACTIVATION CODE DOESN’T HAVE AN EXTRA SPACE WHEN ENTERING THE CODE. Had an issues when trying to set up the user account and would get a ‘invalid field bad format’ error.
    - **Step 3  - Create User Account**: This is a Nessus administrator, the default is `admin`.
		-  If you get any error doublecheck activation code to make sure there’s no code and try using google chrome
1. <u>Let Nessus Download</u>: This is when the nessus plugins will be downloaded which can take a while. Nessus needs a lot of ram and storage when downloading the plugins and compiling the plugins. If you run out of resources, it will restart from scratch constantly until all of the plugins are downloaded. Ideally have at least 4GB Ram and 10GB of storage available on the system.
2. Done! You should be able to perform some scans now
   
---
### Performing Nessus Scan

You can either scan using a pre-existing template or create a custom scan: 

1. **Scanning using a Pre-existing template**
    
    Nessus has built-in scanning templates that you can use to either perform a basic scan or a special/targeted scan. (On the left-side pane, click ‘`Policies`’ > `Scan Templates`). In Nessus, scan templates are predefined configurations used to conduct security assessments and vulnerability scans on networks, systems, and applications. These templates are designed to streamline the scanning process by setting specific parameters and options that target various types of security checks, such as basic network scans, compliance audits, or advanced vulnerability detection. These can be helpful if you either……
    
    1. Don’t really know what kind of scan you want. A ‘Basic Network Scan’ is a good option for a generic scan.
    2. Have a specific scan you’d like to run. Here you can do a something like malware, mobile device, web app tests, etc.
    
    - basic network scan = This will be a basic vulnerability scan, this scans the network
    - host discovery scan = Checks for live hosts but doesn’t perform a vulnerability scan
    

---

**IMPORTANT CONCEPT: Common Vulnerability and Exposures (CVE)**

CVE stands for Common Vulnerabilities and Exposures. It is a list that provides unique identifiers for publicly known cybersecurity vulnerabilities. The CVE identifier is formatted as "CVE" followed by the year of the vulnerability's public disclosure and a unique serial number, such as CVE-2023-12345.

---

2. **Create your own custom scan**

From the Scan Templates page > Click ‘Advanced Scan’

##### Custom Scan: Settings Tab
The Settings tab in a Nessus scan configuration is where you specify the details of how the scan is to be conducted. This includes defining the name and description of the scan, configuring the target IP addresses or hostname ranges, setting the scan schedule and selecting the type of scan. Additional options may include adjusting performance settings like the scan speed.

1. **BASIC SECTION** – Defines general scan parameters like the name, target IPs, and description.
	- **General**: General information, the name and targets is required for the scan. For the targets, you can can either….
		1. **Specify Targets Directly**: _Separate each by a comma_
			- Single Target = `192.168.1.1`    
			- IP Address Range = `192.168.1.1 - 192.168.1.15`        
			- Subnet = `192.168.2.0/24`        
			- Domain Names = `test.com`
		2. **Upload File of Targets** = You can upload a text file that specifies targets where each line is used for each target.      
	- **Schedule**: You can schedule the scan at a certain time with a certain frequency. Disabled by default, you just need to enable it
	- **Notifications**: You can specify who to email when the scan is done

2. **DISCOVERY SECTION** – Configures the scan type Nessus will use to identify live hosts, services, and open ports.
3. **ASSESSMENT SECTION** – Determines which vulnerabilities like web application vulnerabilities
4. **REPORT SECTION** – Specifies how scan results will be compiled and formatted in the final report.
5. **ADVANCED SECTION** – Offers detailed options for scan performance, timeouts, and depth of analysis.


###### Credentialed Scan vs Non-credentialed scan

Non-credentialed is when you don’t have authentication privileges when scanning. In black-box situations, you’ll run un-credentialed scans unless you’re able to find some credentials. In white-box situations, like when a client provides you creds, you can run a credentialed scan. A scan like the ‘Credentialed Patch Audit’ is not attempting to exploit any services its just attempting to authenticate with services and see which ones need to be patched.

##### Custom Scan: Credentials Tab
The Credentials tab is for configuring authenticated scans. Authenticated scans are more comprehensive because they allow Nessus to log into systems as a user (or users) and evaluate the software and system settings from the perspective of those accounts. This can reveal vulnerabilities that an unauthenticated scan might miss, such as those that depend on specific software configurations or permissions granted to authenticated users. You can first select the category of the credentials needed for a type of scan:
- ‘**Host**’ can have credentials like, windows specific creds, SSH, SNMP etc.
- With the ‘**Database**’ category: If a host has a DBMS installed and you have the credentials to the database, you can provide credentials here. You can specify things like the type of database it is etc.
##### Custom Scan: Plugins Tab
The "Plugins" tab allows you to select and configure/enable specific plugins that can check for particular vulnerabilities in systems and networks or to gather certain types of information about the target systems. Some of these tasks plugins include:
- checking for outdated software versions
- missing patches
- configuration weaknesses
    
In Nessus, plugins are organized into families, you can enable or disable entire families of plugins or individual plugins based on the scan's objectives. This customization allows you to tailor the scan to specific security needs, focusing on relevant vulnerabilities while reducing unnecessary network traffic and scan times.
    
**IMPORTANT: When you’re setting up your own personalized scan, all of the plugins are enabled by default. This can include unnecessary plugins which increase the time of the scan**
    
##### Run The Scan
When you’re done with all of the config changes, you can click ‘`Save`’ to save the scan. Back at the Scans screen, click, ‘`Launch`’ to start the scan.
##### DONE: The scan will likely take some time depending on the number of hosts and plugins, so keep this in mind

### View the Vulnerability Report

After completing a scan, you’ll see a checkmark indicating the scan is finished. Click on the scan name to access its results. In the **Vulnerabilities** tab, you’ll find all detected vulnerabilities, listed by severity by default. These vulnerabilities are grouped, click on a group to view the associated vulnerabilities, providing a detailed list of what was found during the scan. 

You can filter out vulnerabilities however you want. Common filters would be around Metasploit Exploit which would shows vulnerabilities with an MSF exploit module or by Severity and look for high severity vulnerabilities.

To get more detailed information on a vulnerability, click on an individual vulnerability, which will open a full page with specific details about the vulnerability. Each vulnerability should contain the following information: 
- **Description**: The description gives a breakdown of each vulnerability with their associated CVE, a solution, and a solution which in the ‘Output’ you can see what would fix the vulnerability.
- **Output**: This section provides specific technical information about what the Nessus scanner observed that led it to identify a particular vulnerability on that system. Essentially, clarifying why a vulnerability was reported . This section typically includes evidence such as system responses, error messages, or configuration data that substantiate the finding.
- **Plugin Details:** The plugin that detected the vulnerability
- **Risk Information:** The "Risk Information" in vulnerability scan reports includes an impact assessment of identified vulnerabilities, using CVSS2 and CVSS3 scores. These scores, calculated from factors like attack complexity, access privileges, and impact on confidentiality, integrity, and availability. The ‘Risk Factor’ (Info, Low, Medium, or High) is determined based on the CVSS2 & CVSS3 scores which can differ in range but can still determine if a vulnerability is high risk or not.
- **Vulnerability Information:** Just additional info about the vulnerability itself, not about the risk. This section can provide links to exploits if it allows
- **Reference Information:** Reference info to the CVEs of the vulnerabilities

### Export Nessus

You can export the result of a Nessus scan and import it to the Metasploit database. Click `Export` within the report then choose 'Nessus' which exports an .nessus XML file.

1. Start up metasploit: Can also create a workspace if you want `workspace -a <workspacename>`
```
services postgresql start && msfconsole
```
2. Import Nessus Scan: Use `db_import` to import the scan results
```
db_import <Location_of_nessus_scan>
```

Can use `hosts` / `services` commands to find the hosts and services respectively. 

3. **Look for specific vulnerabilities**:  All of the vulnerabilities that were found can be found using the `vulns` command. Can search for vulnerabilities for a port using the `-p` option.

```
vulns -p 445
```
4. **Find exploit modules**: You can search using a CVE or Microsoft Vulnerability Identifier. For example, if looking at CVE-2017-0143, you can take the year of the CVE (ie 2017) and search the name which could be for the service/software name etc:

```
search cve:2017 name:smb
```

---

## WMAP

WMAP is a web application vulnerability scanner integrated with Metasploit (MSF). It automates web server enumeration and scans web applications for vulnerabilities, making it accessible as an MSF plugin that can be directly used within the Metasploit framework.
1. <u>Start up metasploit</u>: Can also create a workspace if you want 
```
services postgresql start && msfconsole

workspace -a <workspacename>
```
2. <u>Load the WMAP plugin</u>: This is done using the `load` command
```
load wmap
```

You can view the type of commands that you can run type `wmap_` + Press `Tab` which should return the commands:

```
wmap_modules  wmap_nodes  wmap_run  wmap_sites  wmap_targets  wmap_vulns 
```

3. <u>Add a site target</u>:  Use `wmap_sites` command to add site or webapp to scan. This represent the overall site/app and not specific URLs/directories etc.  Use the `-a` option to add a site, you can view your sites with the `-l` option.

```
wmap_sites -a 192.168.80.3
```

4.  <u>Add the URLs</u>: Use `wmap_targets` for the actual URLs/endpoints, files within the sites listed in `wmap_sites` that will be scanned. Use the `-t` option for adding the URLs, you can view your targets with the `-l` option.
```
wmap_targets -t http://192.168.80.3
```

5. <u>Run the vulnerability scan</u>: The `wmap_run` command with the `-e` option will run the actual scan. The scan will choose which metasploit auxiliary modules that it will enable to perform the vulnerability scan based on the target's configuration:
```
wmap_run -e
```
- You can view what the enabled aux modules will be what the using `wmap_run -t`

6. <u>View Found Vulnerabilities</u>: The `wmap_vulns` command will list the vulnerability's that were found from the scan. Use the `-l` option with the command to view them.
``
```
wmap_vulns -l
```
Should be able to find directories/files/version and other sensitive information form the output.


##### HTTP POST/PUT

The POST and PUT http methods can be used to malicious actions which is why they're normally not allowed on webservers. This can be used to upload a web payload to the target webserver and setup a reverse listener and when they browse to the website/file that the payload will be executed.

The `auxiliary/scanner/http/options` modules would tell if what HTTP methods were allowed on the server.

Can use something like the `auxiliary/scanner/http/http_put` module which can be used to add files to the webserver:

- `ACTION` = This can be PUT or DELETE
- `FILEDATA` = The file to upload into the file
- `FILENAME` = The path to attempt to write or delete

