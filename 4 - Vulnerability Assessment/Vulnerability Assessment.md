
1. Windows Vulnerabilities

---
### Windows Vulnerabilities Overview

The various OS versions/relates makes the threat surface fragmented since some vulnerabilities  that exist in on OS might not be present in another. All Windows versions share common issues:
- The OS is built in C, making them prone to buffer overflows, arbitrary code exec etc. 
- Vulnerable to cross platform vulnerabilities (ie SQL Injection attacks)
- Vulnerable to physical attacks (theft, malicious usb devices)
### Common Windows Vulnerability Types

- **Information Disclosure:** Allows unauthorized access to sensitive data.
- **Buffer Overflows:** Caused by programming errors, allowing malicious code to overwrite memory and potentially execute malware or provide remote access.
- **Remote Code Execution:** Lets attackers execute code remotely on the system.
- **Privilege Escalation:** Allows attackers to elevate privileges post-compromise, often due to misconfigurations.
- **Denial of Service (DoS):** Overloads system resources, preventing normal operation.
### Commonly Exploited Windows Services

- **Microsoft IIS** (TCP 80/443): Web server software used on Windows.
- **WebDAV** (TCP 80/443): HTTP extension for file management on web servers.
- **SMB/CIFS** (TCP 445): File sharing protocol for local networks.
- **RDP** (TCP 3389): Remote access protocol used for GUI-based interactions with Windows systems.
- **WinRM** (TCP 5986/443): Windows remote management protocol for executing remote commands.
---
### Vulnerability Scanning 

Vulnerability scanning & detection is the process of scanning a target for vulnerabilities and verifying whether they can be exploited. This information will useful during the exploitation phase
## Vulnerability Scanning with MSF

Can use auxiliary and exploit modules to scan and identify inherent vulnerabilities in services, OS's and webapps.

- Start PostgreSQL/MSFConsole: `service postgresql start` > `msfconsole`
- (Optional) Can create a workspace: `workspace -a workspace_name`
- (Optional) Can set the RHOST/RHOSTS global variables set you dont have to set the IP for each module execution `setg RHOST target`
### 1. Getting Service Versions and Operating Systems

Goal: Key piece of information for vulnerability scanning for a target OS or services running on it is the service version. Can get service info and the OS from nmap or metasploit modules: 

**a.  Scan using NMap**

```
db_nmap -sS -sV -O -p- target
```




- `-sS` SYN Scan/Stealth Scan 
- `-sV` Service Version detection
- `-O`   Operating system detection
- `-p-`  The full TCP port range (65,535)

**b. Scan using Metasploit**

Metasploit doesn't have a single module that does everything in one shot like `nmap`, need to combine different auxiliary modules to accomplish this:
1. Can use `auxiliary/scanner/portscan/tcp` for a general TCP scan or `auxiliary/scanner/portscan/syn` to perform the SYN scan.
```
use auxiliary/scanner/portscan/tcp
set RHOSTS <target>
set PORTS 1-65535
run
```
2. **Getting Service Version**: Use various service version modules (like `http_version`, `smb_version`) to detect services and versions.
```
use auxiliary/scanner/smb/smb_version
set RHOSTS <target>
run
```
3. **Getting OS**: There isn't a direct way to perform OS detection with metasploit. Some auxiliary scanners like smb_version can have OS detection but you might need use exploits to fingerprint the system. 
### 2. Look for Exploits/Vulnerabilities

There's a number of way to search for exploit and vulnerabilities:
#### 2.a - Manual Search in Metasploit
The found services and their version from the scans should be in `services` in Metasploit. Take each of the observed services and look through Metasploit using its built-in utility for any exploits for each of them

```
search type:exploit name:<service_name>
```

If you don't find the service  in Metasploit, it could be that:
1. The particular version of the service isn't vulnerable to any inherent exploit or
2. There isn't a Metasploit exploit available to exploit the service 

If you <u>do</u> find a service that might work with an exploit, you can  double-check through the module's description to confirm that the version of the service would.
```
use <module>
info
```

**Random note**: Confirm the operating system (Linux/Windows) for the payload so that you can get a meterpreter session

```
set payload windows/meterpreter/reverse_tcp
```

#### 2.b - Kali Searchsploit

Another search option for looking for exploits is built-in to Kali which is `searchsploit`.  Searchsploit is a cmd-line utility which searches the ExploitDB for exploits. The searches can bring in exploit/exploit code that isn't available in Metasploit console and also Metasploit exploits, so we can limit the search to just metasploit exploit modules. Metasploit modules will have (Metasploit) in the exploits name so we can grep the search to filter the other results out:
```
searchsploit " <service> " | grep -e "Metasploit"
```
You can see some of the service versions from the `searchsploit " <service> "` search of some of the exploits and the exploits with the a metasploit equivalent module should have OS versions to see if it works for the target.

#### 2.c - Metasploit Autopwn

Autopwn is a plugin that does a scan of the open services and provides exploit modules that could work with each of the services. This only works best after enumerating services

- Link to Github: https://github.com/hahwul/metasploit-autopwn

- download db_autopwn.rb file in metasploit plugin directory

```
#> wget https://raw.githubusercontent.com/hahwul/metasploit-autopwn/master/db_autopwn.rb
```

If saved to downloads...
```
sudo mv db_autopwn.rb /usr/share/metasploit-framework/plugins/
```
- Load the plugin
```
load db_autopwn
```

- Run the plugin: This can be overwhelming, so narrowing the search to just ports would provide a list of exploits for a port
```
db_autopwn -p -t -PI <port>
```
- `-p` Select modules based on open ports
- `-t` Shows all matching exploit modules
- `-PI` Only exploit hosts with these ports open

#### 2.d. - Analyze Command

The Metasploit `analyze`  command will analyze the contents of the metasploit database (hosts,services) and provide a list of vulnerabilities that the services are affected by.

```
analyze
```

Can see the found vulnerabilities using `vulns`.

---

